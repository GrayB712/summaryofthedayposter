<!DOCTYPE html>
<html>
<head id="thehead">
<center>

<input style="margin: 0.4rem 0;" type="date" id="start"
       value="2023-03-01"
       min="2023-03-01" max="2030-12-31">
<select style="background:none; width:150" align="right" id="class-names">
    <option value="WorldHistory">World History</option>
  <option value="Spanish2">Spanish 2</option>
  <option value="Algebra2">Algebra 2</option>
  <option value="Biology">Biology</option>
<option value="PreApEnglish">Pre-AP English</option>
<option value="SophomoreBible">Sophomore Bible</option>
<option value="Chemistry">Chemistry</option>
      <option value="Geometry">Geometry</option>
      <option value="Spanish1">Spanish I</option>
      <option value="Physical Science">Physical Science</option>
      <option value="Art">Art</option>
      <option value="English2">English II</option>
      <option value="Band">Band</option>
</select>
       <p id="success" style="font-family:Arial;font-size:15px; color:green"></p>
</center>
</head>
<center>
      <br> 
<body id="thebody" onload="setTheDate()" style="margin-left:auto; margin-right:auto">

<form>
      <textarea id="comment" rows="20" cols="100"></textarea><br>




      <button id="submitButton" onclick="addComment(document.querySelector('#comment').value)" style="background-color:darkblue; border-radius:5px; color:white; border:none; width:90px; height:40px; margin-left: auto; margin-right: auto" type="button">Submit</button>
    </form>
    









<script>
var userName = "";
//let token = null;
function setTheDate(){
// An array of strings to check against
const arrayToCheck = ["Admin", "jmKf5", "Admin", "dWgd5", "Ethan Ash", "iM5cZ", "Gavin Baldwin", "IVd41", "Addison Bartley", "zIIFu", "Anna Beagley", "yAKwj", "Graydon Bruyn", "irPjn", "Jacob Buller", "hKhG3", "Caroline Caldwell", "t3bKD", "Andrew Campbell", "87omS", "Kalynn Campbell", "MBOUi", "Conley Cayot", "7NCH5", "Brianna Colby", "ai0fI", "Madison Dorrell", "3uN3W", "Wyatt Hofen", "dAbt6", "Aaliyah Hopper", "nGS26", "Joseph Jas", "jSzNX", "Karson Jenkins", "YiP9S", "Ethan Lang", "lk9HV", "Isobell Leech", "xE7QS", "Eliza Lentz", "Vg3lw", "Lily Loughman", "WCDjN", "Kara Martin", "85tsN", "Elizabeth Miller", "vtGEH", "Bennett ONeill", "yQp1u", "Lukas Olsen", "ubT9Q", "Brant Owens", "0eeNk", "Elexis Pendleton", "MYDMD", "Chloe Ray", "Gknu6", "Ryan Redelsperger", "2rI2r", "Ezra Reese", "0l5dH", "Blakelee Schneider", "zjXnJ", "Eric Smith", "24RcV", "Lilyan Walden", "zjLdl", "Haley Weatherford", "yT9n8", "Luke Lohman", "uZ78I", "Brooke White", "JC6e7", "Ayden Clingenpeel", "fSDdY", "Ben Bearden", "jkB8v", "Shawna Justice", "LDEO7"];
let token = getCookie("key");
const lastFive = token.substr(-5);
// Loop through the array and check if the last five characters match
for (let i = 0; i < arrayToCheck.length; i++) {
  if (arrayToCheck[i].substr(-5) === lastFive) {
    // Output the last five characters if there is a match
    userName = arrayToCheck[(i-1)];
  }
}
console.log(userName);
date = new Date();
year = date.getFullYear();
month = date.getMonth() + 1;
day = date.getDate();
document.getElementById("start").valueAsDate = new Date();
if (navigator.userAgent.match(/Android/i)
         || navigator.userAgent.match(/webOS/i)
         || navigator.userAgent.match(/iPhone/i)
         || navigator.userAgent.match(/iPad/i)
         || navigator.userAgent.match(/iPod/i)
         || navigator.userAgent.match(/BlackBerry/i)
         || navigator.userAgent.match(/Windows Phone/i)) {
            document.getElementById("comment").rows="25";
            document.getElementById("comment").cols="40";
         }

const theKey = getCookie("key");
const newString = getCookie("key");
if(theKey != "")
{
//token = theKey;
//document.getElementById("errors").innerHTML= "The Key:" + theKey;
} else {
       document.getElementById("start").style = "display:none";
       document.getElementById("class-names").style = "display:none";
       document.getElementById("comment").style = "display:none";
       document.getElementById("submitButton").style = "display:none";
       document.getElementById("success").innerHTML = "You must be signed in to add a summary";
       document.getElementById("success").style = "color:red; font-size:40px; font-family:Arial";
}
}
  
function getCookie(cname) {
  let name = cname + "=";
  let decodedCookie = decodeURIComponent(document.cookie);
  let ca = decodedCookie.split(';');
  for(let i = 0; i <ca.length; i++) {
    let c = ca[i];
    while (c.charAt(0) == ' ') {
      c = c.substring(1);
    }
    if (c.indexOf(name) == 0) {
      return c.substring(name.length, c.length);
    }
  }
  return "";
}

      function addComment(comment) {
        const whichClass = document.getElementById("class-names").value;
        let token = getCookie("key");
        const lastFive = token.substr(-5);


        const repo = `GrayB712/summaryoftheday`;
        const path = `${whichClass}/${document.getElementById("start").value}*${new Date().toISOString()}`;
        const url = `https://api.github.com/repos/${repo}/contents/${path}.git`;
        const message = `Add comment ${whichClass}/${document.getElementById("start").value}*${new Date().toISOString()}`;
        const content = btoa(`<br><br><b><u>${userName}</u></b>: ${comment}`);

        fetch(url, {
          method: 'PUT',
          headers: {
            Authorization: `Bearer ${token}`,
            'Content-Type': 'application/json',
            Accept: 'application/vnd.github.v3+json'
          },
          body: JSON.stringify({
            message: message,
            content: content
          })
        })
        .then(response => {
          if (!response.ok) {
            throw new Error(response.statusText);
          }
          return response.json();
        })
        .then(data => {
          const successMessage = `Summary added to ${document.getElementById("class-names").value}`;
          document.getElementById("success").innerHTML=successMessage;
          const errorMessage = '';
          updateErrorMessage(successMessage, errorMessage);
        })
        .catch(error => {
          const successMessage = '';
          const errorMessage = error.message;
          updateErrorMessage(successMessage, errorMessage);
        });
      }

      function updateErrorMessage(successMessage, errorMessage) {
        const errorMessageElement = document.querySelector('#error-message');
        if (errorMessage) {
          //errorMessageElement.textContent = errorMessage;
        } else {
          //errorMessageElement.textContent = successMessage;
        }
      }

      const form = document.querySelector('form');
      form.addEventListener('submit', event => {
        event.preventDefault();
        const comment = document.querySelector('#comment').value;
        addComment(`${userName}: ${comment}`);
      });
    </script>





</center>

</body>
</html>
