<!DOCTYPE html>
<html>
<head id="thehead">
<center>
<p id="errors"><p>
<input style="margin: 0.4rem 0;" type="date" id="start"
       value="2023-03-01"
       min="2023-03-01" max="2030-12-31">
<select style="background:none; width:150" align="right" id="class-names">
    <option value="WorldHistory">World History</option>
  <option value="Spanish2">Spanish 2</option>
  <option value="Algebra2">Algebra 2</option>
  <option value="Biology">Biology</option>
<option value="PreApEnglish">Pre-AP English</option>
<option value="SophomoreBible">Sophomore Bible</option>
<option value="Chemistry">Chemistry</option>
</select>
</center>
</head>
<center>
      <br> 
<body id="thebody" onload="setTheDate()" style="margin-left:auto; margin-right:auto">

<form>
      <textarea id="comment" rows="20" cols="100"></textarea><br>
<p id="errors">


</p>
      <button onclick="addComment" style="background-color:darkblue; border-radius:5px; color:white; border:none; width:90px; height:40px; margin-left: auto; margin-right: auto" type="button">Submit</button>
    </form>
    <p id="error-message"></p>
<p>Enter Key Here:</p>
<input type="text" id="keyer">









<script>
function setTheDate(){
date = new Date();
year = date.getFullYear();
month = date.getMonth() + 1;
day = date.getDate();
document.getElementById("start").valueAsDate = new Date();
if (navigator.userAgent.match(/Android/i)
         || navigator.userAgent.match(/webOS/i)
         || navigator.userAgent.match(/iPhone/i)
         || navigator.userAgent.match(/iPad/i)
         || navigator.userAgent.match(/iPod/i)
         || navigator.userAgent.match(/BlackBerry/i)
         || navigator.userAgent.match(/Windows Phone/i)) {
            document.getElementById("comment").rows="25";
            document.getElementById("comment").cols="40";
         }

const theKey = getCookie("key");
const newString = getCookie("key");
if(theKey != null)
{
let token = theKey;
document.getElementById("errors").innerHTML= "The Key:" + theKey;
} else {
history.back();
}
}

function getCookie(cname) {
  let name = cname + "=";
  let decodedCookie = decodeURIComponent(document.cookie);
  let ca = decodedCookie.split(';');
  for(let i = 0; i <ca.length; i++) {
    let c = ca[i];
    while (c.charAt(0) == ' ') {
      c = c.substring(1);
    }
    if (c.indexOf(name) == 0) {
      return c.substring(name.length, c.length);
    }
  }
  return "";
}

      

      getToken();

      function addComment(comment) {
        token = document.getElementById("keyer").value;
        const repo = 'GrayB712/summaryoftheday';
        const path = `${new Date().toISOString()}`;
        const url = `https://api.github.com/repos/${repo}/contents/${path}.git`;
        const message = `Add comment ${new Date().toISOString()}`;
        const content = btoa(comment);

        fetch(url, {
          method: 'PUT',
          headers: {
            Authorization: `Bearer ${token}`,
            'Content-Type': 'application/json',
            Accept: 'application/vnd.github.v3+json'
          },
          body: JSON.stringify({
            message: message,
            content: content
          })
        })
        .then(response => {
          if (!response.ok) {
            throw new Error(response.statusText);
          }
          return response.json();
        })
        .then(data => {
          const successMessage = `Comment added to ${data.content.html_url}`;
          const errorMessage = '';
          updateErrorMessage(successMessage, errorMessage);
        })
        .catch(error => {
          const successMessage = '';
          const errorMessage = error.message;
          updateErrorMessage(successMessage, errorMessage);
        });
      }

      function updateErrorMessage(successMessage, errorMessage) {
        const errorMessageElement = document.querySelector('#error-message');
        if (errorMessage) {
          errorMessageElement.textContent = errorMessage;
        } else {
          errorMessageElement.textContent = successMessage;
        }
      }

      const form = document.querySelector('form');
      form.addEventListener('submit', event => {
        event.preventDefault();
        const comment = document.querySelector('#comment').value;
        addComment(comment);
      });
    </script>





</center>

<script>


windowClose(){
window.close();
}
</script>
</body>
</html>
